<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TV Shows — Popcorn Picks</title>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6052420824639800"
        crossorigin="anonymous"></script>

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    background:#0b0b0c;
    color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  }
  a{text-decoration:none;color:inherit}

  .top{
    position:sticky;top:0;
    display:flex;justify-content:space-between;align-items:center;
    padding:16px 20px;
    background:rgba(10,10,10,.88);
    backdrop-filter:blur(10px);
    border-bottom:1px solid #222;
    z-index:50;
  }
  .top b{font-size:16px}

  .wrap{padding:18px 18px 8px}
  .controls{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .search{
    flex:1;
    min-width:240px;
    display:flex;
    gap:10px;
  }
  .search input{
    width:100%;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid #222;
    background:#111;
    color:#fff;
    outline:none;
  }
  .btn{
    padding:12px 14px;
    border-radius:12px;
    border:1px solid #222;
    background:#141414;
    color:#fff;
    cursor:pointer;
  }
  .btn:active{transform:translateY(1px)}
  .small{
    color:#aaa;
    font-size:12px;
    padding:10px 2px 0;
    line-height:1.4;
  }

  .chips{
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  .chip{
    border:1px solid #222;
    background:#111;
    color:#ddd;
    padding:10px 12px;
    border-radius:999px;
    font-size:13px;
    cursor:pointer;
    user-select:none;
  }
  .chip.on{
    border-color:#444;
    background:#1b1b1b;
    color:#fff;
  }

  .grid{
    padding:16px 18px 26px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
    gap:18px;
  }

  .card{
    border-radius:18px;
    border:1px solid #181818;
    overflow:hidden;
    position:relative;
    background:#111;
    min-height:320px;
    cursor:pointer;
  }
  .poster{
    height:320px;
    background:#111;
    background-size:cover;
    background-position:center;
  }
  .info{
    position:absolute;
    bottom:0;left:0;right:0;
    padding:14px;
    background:linear-gradient(to top,rgba(0,0,0,.92),transparent);
  }
  .title{font-size:18px;font-weight:650;line-height:1.2}
  .meta{font-size:12px;color:#aaa;margin-top:4px}
  .tagsline{
    font-size:12px;
    color:#cfcfcf;
    margin-top:8px;
    opacity:.9;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }

  .empty{
    padding:22px 18px 30px;
    color:#aaa;
    display:none;
  }

  /* MODAL */
  .modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.72);
    display:none;
    align-items:center;
    justify-content:center;
    padding:18px;
    z-index:999;
  }
  .modal.on{display:flex}
  .sheet{
    width:min(980px, 100%);
    border:1px solid #1f1f1f;
    background:#0f0f0f;
    border-radius:18px;
    overflow:hidden;
  }
  .sheetTop{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 14px;
    border-bottom:1px solid #1f1f1f;
    background:#0d0d0d;
  }
  .closeBtn{
    border:1px solid #222;
    background:#141414;
    color:#fff;
    border-radius:12px;
    padding:10px 12px;
    cursor:pointer;
  }
  .sheetBody{
    padding:16px;
    display:grid;
    grid-template-columns:320px 1fr;
    gap:16px;
  }
  .bigPoster{
    height:460px;
    border-radius:16px;
    border:1px solid #1b1b1b;
    background:#111;
    background-size:cover;
    background-position:center;
  }
  .h1{
    font-size:26px;
    font-weight:750;
    line-height:1.1;
  }
  .muted{color:#aaa;font-size:13px;line-height:1.5;margin-top:8px}
  .why{
    margin-top:14px;
    font-size:14px;
    line-height:1.8;
    color:#ddd;
    white-space:pre-line;
  }
  .pills{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
  .pill{
    font-size:12px;
    border:1px solid #222;
    background:#111;
    padding:8px 10px;
    border-radius:999px;
    color:#d8d8d8;
  }

  @media(max-width:900px){
    .sheetBody{grid-template-columns:1fr}
    .bigPoster{height:420px}
  }
</style>
</head>

<body>

<div class="top">
  <a href="index.html">← Home</a>
  <b>TV Shows</b>
  <span></span>
</div>

<div class="wrap">
  <div class="controls">
    <div class="search">
      <input id="q" type="text" placeholder="Search title, year, genre, country, vibe..." autocomplete="off" />
      <button class="btn" id="clearBtn" type="button">Clear</button>
    </div>
    <button class="btn" id="clearFiltersBtn" type="button">Clear filters</button>
  </div>

  <div class="small" id="resultCount"></div>
  <div class="chips" id="chips"></div>
</div>

<div class="grid" id="grid"></div>
<div class="empty" id="empty">No matches. Try removing filters or changing the search.</div>

<!-- MODAL -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <div class="sheetTop">
      <div style="font-weight:700">Details</div>
      <button class="closeBtn" id="closeBtn" type="button">Close</button>
    </div>
    <div class="sheetBody">
      <div class="bigPoster" id="mPoster"></div>
      <div>
        <div class="h1" id="mTitle">—</div>
        <div class="muted" id="mMeta"></div>
        <div class="pills" id="mPills"></div>
        <div class="why" id="mWhy"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   TV DATA (EDIT HERE ONLY)
   ========================= */
const TV = [
  {
    id:"silo",
    title:"Silo",
    year:"2023–",
    meta:"Sci-Fi • Mystery • Thriller",
    seasons:"2 seasons (ongoing)",
    genres:["Sci-Fi","Mystery","Thriller","USA","Dystopia"],
    poster:"assets/posters/tv/silo.jpg.JPG",
    summary:"In a vast underground silo, society survives on strict rules and a carefully edited version of history. When deaths and disappearances start to line up like clues, an engineer pulls at the first loose thread—and discovers the silo isn’t protecting people from the world outside as much as it’s protecting a lie from the people inside."
  },
  {
    id:"bosch",
    title:"Bosch",
    year:"2014–2021",
    meta:"Crime • Detective • Neo-Noir",
    seasons:"7 seasons",
    genres:["Crime","Detective","Neo-Noir","USA","Investigation"],
    poster:"assets/posters/tv/bosch.jpg.JPG",
    summary:"Harry Bosch works homicide in Los Angeles with a stubborn moral code and a detective’s obsession for what doesn’t add up. Each case moves through procedure, politics, and pressure, but Bosch keeps going until the evidence tells the story—even when the department would rather close the file and move on."
  },
  {
    id:"slow-horses",
    title:"Slow Horses",
    year:"2022–",
    meta:"Espionage • Dark Comedy • Thriller",
    seasons:"Multiple seasons (ongoing)",
    genres:["Espionage","Thriller","UK","Dark Comedy"],
    poster:"assets/posters/tv/slow-horses.jpg.JPG",
    summary:"MI5’s rejects are dumped in Slough House to rot in paperwork and regret—until real danger keeps landing on their doorstep. Led by the brilliant and unbearable Jackson Lamb, they stumble into conspiracies the ‘proper’ agents can’t touch, winning through instinct, stubbornness, and tradecraft that still works when it counts."
  },
  {
    id:"the-bureau",
    title:"The Bureau (Le Bureau des Légendes)",
    year:"2015–2020",
    meta:"Espionage • Psychological • Prestige",
    seasons:"5 seasons",
    genres:["Espionage","Psychological","France","Tradecraft"],
    poster:"assets/posters/tv/the-bureau.jpg.JPG",
    summary:"A French intelligence officer returns from years undercover and finds the hardest part isn’t espionage—it’s coming back to himself. Built around realistic tradecraft, the series treats spying as long-term psychological damage: cover identities, handlers, assets, and the quiet erosion of whatever used to feel real."
  },
  {
    id:"bodyguard",
    title:"Bodyguard",
    year:"2018",
    meta:"Political Thriller • Action",
    seasons:"1 season",
    genres:["Thriller","Action","UK","Politics"],
    poster:"assets/posters/tv/bodyguard.jpg.JPG",
    summary:"A war-scarred protection officer is assigned to guard a powerful politician he distrusts. As terror threats escalate and government agendas tighten like a noose, every security detail becomes a test of loyalty—and the closer he gets to the truth, the more he looks like the person everyone should fear."
  },
  {
    id:"marco-polo",
    title:"Marco Polo",
    year:"2014–2016",
    meta:"Historical • Adventure • Court Politics",
    seasons:"2 seasons",
    genres:["History","Adventure","Politics","International"],
    poster:"assets/posters/tv/marco-polo.jpg.JPG",
    summary:"A young outsider is drawn into Kublai Khan’s empire and quickly learns that survival at court isn’t about bravery—it’s about reading power before it moves. Battles, alliances, betrayals, and ambition collide in a world where one wrong conversation can be deadlier than a battlefield."
  },
  {
    id:"jack-ryan",
    title:"Tom Clancy’s Jack Ryan",
    year:"2018–2023",
    meta:"Espionage • Action • Thriller",
    seasons:"4 seasons",
    genres:["Espionage","Action","Thriller","USA"],
    poster:"assets/posters/tv/jack-ryan.jpg.JPG",
    summary:"An analyst follows a suspicious financial pattern and gets dragged from desk work into global operations. The series blends intel work with high-stakes action as one clue turns into a chain reaction across borders—where every ‘small’ detail is attached to someone’s bigger plan."
  },
  {
    id:"alex-rider",
    title:"Alex Rider",
    year:"2020–2024",
    meta:"Spy • Thriller • Coming-of-Age",
    seasons:"3 seasons",
    genres:["Espionage","Thriller","UK"],
    poster:"assets/posters/tv/alex-rider.jpg.JPG",
    summary:"After his guardian’s death, a teenager discovers his life was built around secrets—and that he’s been trained for a world he never agreed to enter. Forced into missions designed for adults, he investigates the people who used him, the agency that lied to him, and the truth hidden inside his own past."
  },
  {
    id:"pennyworth",
    title:"Pennyworth",
    year:"2019–2022",
    meta:"Crime • Spy • Origin Story",
    seasons:"3 seasons",
    genres:["Crime","Espionage","UK","Stylish"],
    poster:"assets/posters/tv/pennyworth.jpg.JPG",
    summary:"Before Gotham myths, Alfred Pennyworth is an ex-soldier running a security business in a London teetering toward chaos. He’s pulled between underground movements, elite conspiracies, and rising violence—where loyalty is currency and every job hints at a larger war forming in the shadows."
  },
  {
    id:"the-originals",
    title:"The Originals",
    year:"2013–2018",
    meta:"Supernatural • Family War • Dark Fantasy",
    seasons:"5 seasons",
    genres:["Supernatural","Dark Fantasy","USA"],
    poster:"assets/posters/tv/the-originals.jpg.JPG",
    summary:"The first vampire family returns to the city they helped build—only to find it ruled by enemies, fragile alliances, and old grudges that never died. As witches, werewolves, and vampires collide, the story becomes a ruthless power struggle where love is leverage and betrayal is tradition."
  },
  {
    id:"chief-of-war",
    title:"Chief of War",
    year:"2025",
    meta:"Historical • War • Epic Drama",
    seasons:"1 season (so far)",
    genres:["History","War","Epic","International"],
    poster:"assets/posters/tv/chief-of-war.jpg.JPG",
    summary:"Set amid shifting alliances and colonial pressure, the series follows leaders and warriors fighting to protect land, identity, and sovereignty. Conflict is shown as strategy and consequence—where battles matter, but the hardest choices happen in councils, families, and the fragile space between unity and survival."
  },
  {
    id:"the-mentalist",
    title:"The Mentalist",
    year:"2008–2015",
    meta:"Crime • Case-of-the-Week • Mystery",
    seasons:"7 seasons",
    genres:["Crime","Mystery","USA","Investigation"],
    poster:"assets/posters/tv/the-mentalist.jpg.JPG",
    summary:"A former con artist uses observation, psychology, and carefully timed deception to help solve murders—while quietly hunting the serial killer who ruined his life. Weekly cases deliver sharp puzzles, but the long arc is about patience: how far you’ll go, and what it costs, to get one person in a room."
  },
  {
    id:"the-good-doctor",
    title:"The Good Doctor",
    year:"2017–2024",
    meta:"Medical • Drama",
    seasons:"7 seasons",
    genres:["Drama","Medical","USA"],
    poster:"assets/posters/tv/the-good-doctor.jpg.JPG",
    summary:"A gifted young surgeon enters a high-pressure hospital where every decision can change a life in minutes. The cases hit hard, but the real tension is trust—earning respect in a system built on hierarchy, doubt, and the constant demand to prove you belong."
  },
  {
    id:"day-of-the-jackal",
    title:"The Day of the Jackal",
    year:"2024",
    meta:"Espionage • Assassin Thriller",
    seasons:"1 season (so far)",
    genres:["Espionage","Thriller","UK","Assassin"],
    poster:"assets/posters/tv/day-of-the-jackal.jpg.JPG",
    summary:"A lethal assassin and a relentless investigator spiral into a modern manhunt powered by surveillance, false identities, and quiet funding. Every move triggers the next: safe houses, contacts, cover stories, misdirection—until the chase becomes less about catching a man and more about exposing the network behind him."
  },

  /* 10 more strong picks */
  {
    id:"true-detective",
    title:"True Detective",
    year:"2014–",
    meta:"Crime • Thriller • Anthology",
    seasons:"4 seasons (anthology)",
    genres:["Crime","Thriller","USA","Investigation"],
    poster:"assets/posters/tv/true-detective.jpg.JPG",
    summary:"Each season follows a different case where crime exposes corruption, obsession, and moral decay. The mystery matters, but the deeper hook is what the case does to the investigators over time—how it bends them, breaks them, or leaves them hollow even after the truth comes out."
  },
  {
    id:"mindhunter",
    title:"Mindhunter",
    year:"2017–2019",
    meta:"Crime • Psychological • Serial Killers",
    seasons:"2 seasons",
    genres:["Crime","Psychological","USA","Investigation"],
    poster:"assets/posters/tv/mindhunter.jpg.JPG",
    summary:"Two FBI agents pioneer a new method: sit down with serial killers and learn how they think before the next murder happens. The tension is slow and clinical, because the danger isn’t a chase—it’s letting monsters explain themselves, and realizing how much of their logic starts to sound familiar."
  },
  {
    id:"the-night-of",
    title:"The Night Of",
    year:"2016",
    meta:"Crime • Courtroom • Character Drama",
    seasons:"1 season",
    genres:["Crime","Courtroom","USA","Drama"],
    poster:"assets/posters/tv/the-night-of.jpg.JPG",
    summary:"One night turns into a life-altering accusation when a young man wakes up beside a murdered woman. The series traces every stage—police, jail, lawyers, court—and shows how the system reshapes everyone it touches, whether they’re guilty, innocent, or simply trapped by what looks true."
  },
  {
    id:"dark",
    title:"Dark",
    year:"2017–2020",
    meta:"Sci-Fi • Mystery • Time",
    seasons:"3 seasons",
    genres:["Sci-Fi","Mystery","Germany","Mind-bending"],
    poster:"assets/posters/tv/dark.jpg.JPG",
    summary:"A missing child exposes a hidden structure connecting families across decades. Time travel isn’t a gimmick here—it’s a trap that turns cause and effect into a tightening loop. As secrets surface, the town’s history becomes a puzzle with emotional weight, where every answer creates a new wound."
  },
  {
    id:"chernobyl",
    title:"Chernobyl",
    year:"2019",
    meta:"Historical • Disaster • Political",
    seasons:"1 season",
    genres:["History","Drama","International","Politics"],
    poster:"assets/posters/tv/chernobyl.jpg.JPG",
    summary:"A nuclear disaster becomes a crisis of physics, politics, and truth. Scientists, officials, and workers fight against denial and delay while the cost rises by the hour. The horror isn’t only the explosion—it’s watching a system choose appearances over reality, even when reality is radioactive."
  },
  {
    id:"narcos",
    title:"Narcos",
    year:"2015–2017",
    meta:"Crime • Cartels • War on Drugs",
    seasons:"3 seasons",
    genres:["Crime","Thriller","International","Gritty"],
    poster:"assets/posters/tv/narcos.jpg.JPG",
    summary:"The rise of a drug empire triggers an arms race between cartels, governments, and the people trapped in the middle. Told through operations, informants, and shifting alliances, the series shows how power grows—and how violence becomes infrastructure, outlasting the men who built it."
  },
  {
    id:"narcos-mexico",
    title:"Narcos: Mexico",
    year:"2018–2021",
    meta:"Crime • Cartels • Power Shift",
    seasons:"3 seasons",
    genres:["Crime","Thriller","International","Gritty"],
    poster:"assets/posters/tv/narcos-mexico.jpg.JPG",
    summary:"As the trade consolidates, a new generation tries to turn chaos into an organized empire. The show focuses on systems: how corruption, enforcement, ambition, and fear combine into an industry that adapts to every crackdown—and keeps finding new ways to survive."
  },
  {
    id:"fargo",
    title:"Fargo",
    year:"2014–",
    meta:"Crime • Dark Comedy • Anthology",
    seasons:"5 seasons (anthology)",
    genres:["Crime","Dark Comedy","USA","Stylish"],
    poster:"assets/posters/tv/fargo.jpg.JPG",
    summary:"Ordinary lives collide with crime and trigger chains of decisions that get worse with every attempt to fix them. Each season stands alone, mixing sharp tension with bleak humor as small moral compromises snowball into disasters nobody can control."
  },
  {
    id:"peaky-blinders",
    title:"Peaky Blinders",
    year:"2013–2022",
    meta:"Crime • Gangster • Period",
    seasons:"6 seasons",
    genres:["Crime","History","UK","Stylish"],
    poster:"assets/posters/tv/peaky-blinders.jpg.JPG",
    summary:"A post-war gang expands into politics, industry, and international conflict as ambition outgrows loyalty. The series runs on strategy, betrayal, and power moves—where every victory creates a new enemy, and every deal carries a hidden threat."
  },
  {
    id:"the-americans",
    title:"The Americans",
    year:"2013–2018",
    meta:"Espionage • Marriage • Cold War",
    seasons:"6 seasons",
    genres:["Espionage","Drama","USA","Psychological"],
    poster:"assets/posters/tv/the-americans.jpg.JPG",
    summary:"Two deep-cover Soviet agents live as an American couple while running operations that could destroy them. The missions are tense, but the real pressure is domestic: identity, loyalty, and family strain under years of deception, until even love starts to feel like another cover story."
  },
  {
  id:"the-night-manager",
  title:"The Night Manager",
  year:"2016",
  meta:"Espionage • Undercover • Psychological",
  seasons:"1 season",
  genres:["Espionage","Thriller","UK","Psychological"],
  poster:"assets/posters/tv/the-night-manager.jpg.jpeg",
  summary:"A former soldier is pulled into an undercover operation against an international arms dealer. The danger comes from proximity—earning trust, living among predators, and surviving one wrong move."
},
{
  id:"the-night-agent",
  title:"The Night Agent",
  year:"2023–",
  meta:"Conspiracy • Government • Action",
  seasons:"2 seasons",
  genres:["Action","Thriller","Political","USA"],
  poster:"assets/posters/tv/the-night-agent.jpg.jpeg",
  summary:"A low-level agent answers a phone that was never meant to ring and ends up uncovering secrets buried deep inside government power. Every truth makes the situation worse."
},
{
  id:"the-recruit",
  title:"The Recruit",
  year:"2022–",
  meta:"CIA • Action • Dark humor",
  seasons:"2 seasons",
  genres:["Spy","Action","Drama","USA"],
  poster:"assets/posters/tv/the-recruit.jpg.jpeg",
  summary:"A CIA lawyer walks into international crises without training, protection, or clear rules. The tension comes from confusion, bad timing, and constantly being one step behind."
},
{
  id:"24",
  title:"24",
  year:"2001–2010",
  meta:"Counter-terror • Real-time • High pressure",
  seasons:"9 seasons",
  genres:["Action","Thriller","USA","Counter-terror"],
  poster:"assets/posters/tv/24.jpg.jpeg",
  summary:"Every season unfolds in real time as crises stack up without pause. Decisions are rushed, mistakes are permanent, and the clock never stops moving."
},
{
  id:"agent-hamilton",
  title:"Agent Hamilton",
  year:"2020–",
  meta:"Espionage • Political • Grounded",
  seasons:"2 seasons",
  genres:["Espionage","Thriller","Sweden","Political"],
  poster:"assets/posters/tv/agent-hamilton.jpg.jpeg",
  summary:"A restrained Swedish spy series focused on compromise, institutional rot, and loyalty limits. Less spectacle, more consequences."
},
{
  id:"macgyver",
  title:"MacGyver",
  year:"2016–2021",
  meta:"Action • Adventure • Procedural",
  seasons:"5 seasons",
  genres:["Action","Adventure","USA","Procedural"],
  poster:"assets/posters/tv/macgyver.jpg.jpeg",
  summary:"A lighter action series built around problem-solving and teamwork rather than paranoia. Easy to watch, low on darkness, high on ingenuity."
},
{
  id:"black-doves",
  title:"Black Doves",
  year:"2024–",
  meta:"Espionage • Assassins • Political",
  seasons:"1 season",
  genres:["Espionage","Thriller","UK","Political"],
  poster:"assets/posters/tv/black-doves.jpg.jpeg",
  summary:"A covert operative balances assassination work with a carefully built civilian life. Secrets pile up, and identity becomes the real risk."
}
];
/* =========================
   APP LOGIC (DON'T EDIT)
   ========================= */
const $ = (id) => document.getElementById(id);

const grid = $("grid");
const chipsEl = $("chips");
const qEl = $("q");
const clearBtn = $("clearBtn");
const clearFiltersBtn = $("clearFiltersBtn");
const resultCount = $("resultCount");
const emptyEl = $("empty");

const modal = $("modal");
const closeBtn = $("closeBtn");
const mPoster = $("mPoster");
const mTitle = $("mTitle");
const mMeta  = $("mMeta");
const mPills = $("mPills");
const mWhy   = $("mWhy");

const fallbackPoster = "assets/home/tv-shows.jpg";
const picked = new Set();

function normalize(s){ return String(s || "").toLowerCase().trim(); }

function buildChips(items){
  const counts = new Map();
  items.forEach(m=>{
    (m.genres || []).forEach(t=>{
      const tag = String(t).trim();
      if(!tag) return;
      counts.set(tag, (counts.get(tag) || 0) + 1);
    });
  });

  const priority = [
    "USA","UK","Korea","Japan","Germany","France","International",
    "Crime","Thriller","Espionage","Mystery","Drama","Sci-Fi","History","War","Courtroom",
    "Psychological","Dark Comedy","Stylish","Gritty","Mind-bending","Investigation","Dystopia"
  ];

  const present = new Set([...counts.keys()]);
  const first = priority.filter(t => present.has(t));

  const rest = [...counts.entries()]
    .filter(([t]) => !priority.includes(t))
    .sort((a,b)=> b[1]-a[1] || a[0].localeCompare(b[0]))
    .map(([t])=>t);

  return [...first, ...rest].slice(0, 40);
}

function chipButton(tag){
  const b = document.createElement("div");
  b.className = "chip" + (picked.has(tag) ? " on" : "");
  b.textContent = tag;
  b.onclick = () => {
    if(picked.has(tag)) picked.delete(tag);
    else picked.add(tag);
    paintChips();
    render();
  };
  return b;
}

function paintChips(){
  chipsEl.innerHTML = "";
  buildChips(TV).forEach(tag => chipsEl.appendChild(chipButton(tag)));
}

function matchesPicked(item){
  if(picked.size === 0) return true;

  const tagsFromGenres = Array.isArray(item.genres) ? item.genres.map(String) : [];
  const tagsFromMeta = String(item.meta || "")
    .split("•")
    .map(s => s.trim())
    .filter(Boolean);

  const tags = new Set([...tagsFromGenres, ...tagsFromMeta]);

  for(const p of picked){
    if(!tags.has(p)) return false;
  }
  return true;
}

function matchesQuery(item, q){
  if(!q) return true;
  const hay = [
    item.title,
    item.year,
    item.meta,
    item.seasons,
    (item.genres || []).join(" "),
    item.summary
  ].join(" ");
  return normalize(hay).includes(q);
}

function getSorted(items){
  return items.slice().sort((a,b)=>{
    // sort by start year desc if possible
    const ya = parseInt(String(a.year||"").slice(0,4)) || 0;
    const yb = parseInt(String(b.year||"").slice(0,4)) || 0;
    if(yb !== ya) return yb - ya;
    return String(a.title || "").localeCompare(String(b.title || ""));
  });
}

function openModal(item){
  const poster = item.poster ? item.poster : fallbackPoster;
  mPoster.style.backgroundImage = `url('${String(poster).replace(/'/g,"\\'")}')`;

  mTitle.textContent = item.title || "Untitled";
  const metaBits = [];
  if(item.year) metaBits.push(item.year);
  if(item.meta) metaBits.push(item.meta);
  if(item.seasons) metaBits.push(item.seasons);
  mMeta.textContent = metaBits.join(" • ");

  mPills.innerHTML = "";
  const tags = (Array.isArray(item.genres) && item.genres.length)
    ? item.genres
    : String(item.meta || "").split("•").map(s=>s.trim()).filter(Boolean);

  tags.slice(0, 8).forEach(t=>{
    const p = document.createElement("div");
    p.className = "pill";
    p.textContent = t;
    mPills.appendChild(p);
  });

  mWhy.textContent = item.summary || "No synopsis added yet.";

  modal.classList.add("on");
  modal.setAttribute("aria-hidden","false");
}

function closeModal(){
  modal.classList.remove("on");
  modal.setAttribute("aria-hidden","true");
}

closeBtn.onclick = closeModal;
modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });
window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

function card(item){
  const div = document.createElement("div");
  div.className = "card";

  const poster = item.poster ? item.poster : fallbackPoster;
  const safePoster = String(poster).replace(/'/g, "\\'");

  const tagLine = (Array.isArray(item.genres) && item.genres.length)
    ? item.genres.slice(0, 5).join(" • ")
    : String(item.meta || "").split("•").map(s=>s.trim()).filter(Boolean).slice(0,5).join(" • ");

  div.innerHTML = `
    <div class="poster" style="background-image:url('${safePoster}');"></div>
    <div class="info">
      <div class="title">${item.title || "Untitled"}</div>
      <div class="meta">${item.year || ""}${item.meta ? " • " + item.meta : ""}</div>
      <div class="tagsline">${tagLine}</div>
    </div>
  `;

  div.onclick = () => openModal(item);
  return div;
}

function render(){
  const q = normalize(qEl.value);

  const filtered = getSorted(
    TV.filter(m => matchesPicked(m) && matchesQuery(m, q))
  );

  grid.innerHTML = "";
  filtered.forEach(m => grid.appendChild(card(m)));

  resultCount.textContent =
    `${filtered.length} title${filtered.length === 1 ? "" : "s"} found` +
    (picked.size ? ` • Filters: ${[...picked].join(", ")}` : "");

  emptyEl.style.display = filtered.length ? "none" : "block";
}

qEl.addEventListener("input", render);

clearBtn.onclick = () => { qEl.value = ""; render(); };
clearFiltersBtn.onclick = () => { picked.clear(); paintChips(); render(); };

paintChips();
render();
</script>

</body>
</html>
